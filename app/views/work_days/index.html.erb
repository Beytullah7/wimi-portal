<%- model_class = WorkDay -%>

<p id="notice"><%= notice %></p>
<div class="col-md-12">
  <div class="display">
    <div class="page-header">
      <h1>
        <div class="row">
          <div class="col-sm-9">
            <% if @year == 0 || @month == 0 %>
              <%= t('.working_hours') %>
            <% else %>
              <%= t('.working_hours_for') %> <%=l Date.new(@year, @month, 1), format: :without_day %>
            <% end %>
          </div>
          <div class="col-sm-3">
            <% wd_args = {} %>
            <% wd_args[:project] = @project if @project %>
            <% if @time_sheets.blank? or @time_sheets.any? {|ts| can? :edit, ts} %>
              <div>
                <%= link_to t('helpers.titles.new', model: model_class.model_name.human.titleize), new_work_day_path(wd_args), class: 'btn btn-success pull-right' %>
              </div>
            <% end %>
          </div>
        </div>
      </h1>
    </div>

    <div class="row">
      <div class="col-md-12">
        <% if @work_days.empty? %>
          <p> <%= t 'no_entries_yet', target: (t 'activerecord.view.work_days.other', default: model_class.model_name.human.pluralize) %> </p>
        <% else %>
          <table  class="table table-striped">
            <thead>
              <tr>
                <th><%= model_class.human_attribute_name(:date) %></th>
                <th><%= model_class.human_attribute_name(:project) %></th>
                <th><%= model_class.human_attribute_name(:time) %></th>
                <th><%= model_class.human_attribute_name(:break) %></th>
                <th><%= model_class.human_attribute_name(:duration) %></th>
                <th><%= model_class.human_attribute_name(:notes) %></th>
                <th><%= t '.actions', default: t("helpers.actions") %></th>
              </tr>
            </thead>

            <tbody>
              <% @work_days.each do |work_day| %>
                <%= content_tag :tr, class: ("highlight" if work_day.project == @project) do %>
                  <td><%= l work_day.date %> <%= "(#{work_day.attendance})" if work_day.attendance.present? %></td>
                  <td><%= work_day.project.title if work_day.project %></td>
                  <td><%= work_day.start_time.strftime('%H:%M') %> &ndash; <%= work_day.end_time.strftime('%H:%M') %></td>
                  <td><%= work_day.break.nonzero? ? "#{work_day.break} min" : "--" %> </td>
                  <td><%= work_day.duration_hours_minutes %></td>
                  <td><%= work_day.notes %></td>
                  <td>
                    <% if can? :edit, work_day %>
                      <%= link_to t('.edit', default: t("helpers.links.edit")), edit_work_day_path(work_day), class: 'btn btn-warning btn-xs' %>
                      <%= link_to t('.destroy', default: t("helpers.links.destroy")),
                        work_day_path(work_day),
                        method: :delete,
                        data: { confirm: t('helpers.links.confirm_delete', model: work_day) },
                        class: 'btn btn-xs btn-danger' %>
                    <% end %>
                  </td>
                <% end -%> <%# </tr> %>
              <% end %>
            </tbody>
          </table>
        <% end %>
      </div>
    </div>

    <% if @user %>
      <div class="row">
        <div class="col-md-12">
          <div class="page-header"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-6">
          <div class="form-group">
            <%= label_tag nil, t('.user') %>
            <%= text_field_tag nil, @user.name, {class: "form-control", readonly: "readonly"} %>
          </div>
        </div>
        <div class="col-sm-6">
        </div>
      </div>
    <% end %>

    <% (@time_sheets || []).each do |ts| %>
    <% @time_sheet = ts %>
      <div class="row">
        <div class="col-md-12">
          <div class="page-header"></div>
        </div>
      </div>
      <%= render "time_sheets/show_footer" %>
    <% end %>

  </div>
</div>
